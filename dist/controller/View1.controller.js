sap.ui.define(["sap/ui/core/mvc/Controller","sap/ui/model/json/JSONModel","sap/m/MessageToast"],function(a,e,t){"use strict";return a.extend("screentest.controller.View1",{onInit:function(){var a={results:[{barcaca:"BAR-001",cte:"35240612345678901234567890123456789012",nfe:"35240698765432109876543210987654321098",material:"SOJA EM GRÃOS",pesoBruto:5420.5,pesoLiquido:5380,dataChegada:new Date(2024,1,15),statusCCT:"Disponível"},{barcaca:"BAR-002",cte:"35240612345678901234567890123456789013",nfe:"35240698765432109876543210987654321099",material:"MILHO",pesoBruto:4850.75,pesoLiquido:4820.3,dataChegada:new Date(2024,1,15),statusCCT:"Processado"},{barcaca:"BAR-003",cte:"35240612345678901234567890123456789014",nfe:"35240698765432109876543210987654321100",material:"FARELO DE SOJA",pesoBruto:6200,pesoLiquido:6150.25,dataChegada:new Date(2024,1,16),statusCCT:"Pendente"},{barcaca:"BAR-001",cte:"35240612345678901234567890123456789015",nfe:"35240698765432109876543210987654321101",material:"SOJA EM GRÃOS",pesoBruto:5100.8,pesoLiquido:5065.4,dataChegada:new Date(2024,1,16),statusCCT:"Disponível"},{barcaca:"BAR-004",cte:"35240612345678901234567890123456789016",nfe:"35240698765432109876543210987654321102",material:"TRIGO",pesoBruto:4320.6,pesoLiquido:4290.15,dataChegada:new Date(2024,1,17),statusCCT:"Cancelado"},{barcaca:"BAR-005",cte:"35240612345678901234567890123456789017",nfe:"35240698765432109876543210987654321103",material:"AÇÚCAR",pesoBruto:7890.45,pesoLiquido:7850.9,dataChegada:new Date(2024,1,17),statusCCT:"Disponível"},{barcaca:"BAR-002",cte:"35240612345678901234567890123456789018",nfe:"35240698765432109876543210987654321104",material:"MILHO",pesoBruto:5670.3,pesoLiquido:5640.75,dataChegada:new Date(2024,1,18),statusCCT:"Processado"},{barcaca:"BAR-006",cte:"35240612345678901234567890123456789019",nfe:"35240698765432109876543210987654321105",material:"CAFÉ",pesoBruto:3450.2,pesoLiquido:3425.8,dataChegada:new Date(2024,1,18),statusCCT:"Pendente"},{barcaca:"BAR-007",cte:"35240612345678901234567890123456789020",nfe:"35240698765432109876543210987654321106",material:"ARROZ",pesoBruto:6780.9,pesoLiquido:6745.55,dataChegada:new Date(2024,1,19),statusCCT:"Disponível"},{barcaca:"BAR-003",cte:"35240612345678901234567890123456789021",nfe:"35240698765432109876543210987654321107",material:"FARELO DE SOJA",pesoBruto:5920.65,pesoLiquido:5885.2,dataChegada:new Date(2024,1,19),statusCCT:"Processado"},{barcaca:"BAR-008",cte:"35240612345678901234567890123456789022",nfe:"35240698765432109876543210987654321108",material:"FERTILIZANTE",pesoBruto:8450.35,pesoLiquido:8400.7,dataChegada:new Date(2024,1,20),statusCCT:"Disponível"},{barcaca:"BAR-009",cte:"35240612345678901234567890123456789023",nfe:"35240698765432109876543210987654321109",material:"CALCÁRIO",pesoBruto:9230.15,pesoLiquido:6180.45,dataChegada:new Date(2024,1,20),statusCCT:"Pendente"}]};var t=new e(a);this.getView().setModel(t);this._updatePanelCharts()},_updatePanelCharts:function(){var a=this.getView().getModel();var e=a.getProperty("/results");var t={};e.forEach(function(a){if(!t[a.statusCCT]){t[a.statusCCT]=0}t[a.statusCCT]++});var o=["Disponível","Processado","Pendente","Cancelado"];var r=[];o.forEach(function(a){if(t[a]){r.push({status:a,quantidade:t[a]})}});var s={pesoBrutoTotal:0,pesoLiquidoTotal:0,diferenca:0};e.forEach(function(a){s.pesoBrutoTotal+=a.pesoBruto;s.pesoLiquidoTotal+=a.pesoLiquido});s.diferenca=s.pesoBrutoTotal-s.pesoLiquidoTotal;var i=[{tipo:"Peso Bruto",valor:Math.round(s.pesoBrutoTotal*100)/100},{tipo:"Peso Líquido",valor:Math.round(s.pesoLiquidoTotal*100)/100},{tipo:"Diferença (Tara)",valor:Math.round(s.diferenca*100)/100}];var n={totalCargas:e.length,pesoBrutoTotal:Math.round(s.pesoBrutoTotal/1e3*100)/100,pesoLiquidoTotal:Math.round(s.pesoLiquidoTotal/1e3*100)/100,divergenciaMedia:Math.round(s.diferenca/s.pesoBrutoTotal*100*100)/100};a.setProperty("/statusChartData",r);a.setProperty("/pesosChartData",i);a.setProperty("/resumo",n);var u=this;setTimeout(function(){u._configureChartColors()},100)},_configureChartColors:function(){var a=this.byId("chartStatusCCT");var e={"Disponível":"#107e3e",Processado:"#0a6ed1",Pendente:"#e9730c",Cancelado:"#bb0000"};var t=this.getView().getModel();var o=t.getProperty("/statusChartData");var r=[];o.forEach(function(a){r.push(e[a.status]||"#5899da")});a.setVizProperties({plotArea:{colorPalette:r,dataLabel:{visible:true,type:"percentage",formatString:"0.0%"}},legend:{title:{visible:false}},title:{visible:false}})},onNavBack:function(){t.show("Voltar pressionado")},onValueHelp:function(){t.show("Value Help pressionado")},onSearchViagem:function(){t.show("Buscar Viagem pressionado")},onDisponibilizar:function(){var a=this.byId("tableResults");var e=a.getSelectedItems();if(e.length===0){t.show("Selecione ao menos um item");return}t.show(e.length+" item(ns) disponibilizado(s) para CCT")},onRemover:function(){var a=this.byId("tableResults");var e=a.getSelectedItems();if(e.length===0){t.show("Selecione ao menos um item");return}t.show(e.length+" item(ns) removido(s) do CCT")},onDataSaida:function(){var a=this.byId("dataSaidaComboio");a.setEnabled(!a.getEnabled());t.show("Data Saída "+(a.getEnabled()?"habilitada":"desabilitada"))},onExport:function(){t.show("Exportando para Excel...")},onRefresh:function(){t.show("Dados atualizados");this._updatePanelCharts()},onViewDetails:function(a){var t=a.getSource().getParent().getParent();var o=t.getBindingContext();var r=o.getObject();var s={barcaca:r.barcaca,cte:r.cte,nfe:r.nfe,material:r.material,pesoBruto:r.pesoBruto,pesoLiquido:r.pesoLiquido,dataChegada:r.dataChegada,statusCCT:r.statusCCT,pesosData:[{tipo:"Peso Bruto",valor:r.pesoBruto},{tipo:"Peso Líquido",valor:r.pesoLiquido},{tipo:"Diferença",valor:r.pesoBruto-r.pesoLiquido}],distribuicaoData:[{categoria:"Peso Líquido",valor:r.pesoLiquido},{categoria:"Tara",valor:r.pesoBruto-r.pesoLiquido}],historicoData:this._getHistoricoDaBarcaca(r.barcaca),comparacaoData:this._getComparacaoBarcacas(r.barcaca)};var i=new e(s);this.getView().setModel(i,"chartData");if(!this._oChartDialog){this._oChartDialog=this.byId("chartDialog")}this._oChartDialog.open()},_getHistoricoDaBarcaca:function(a){var e=[];var t=this.getView().getModel();var o=t.getProperty("/results");var r=o.filter(function(e){return e.barcaca===a});for(var s=0;s<Math.max(5,r.length);s++){if(r[s]){var i=new Date(r[s].dataChegada);e.push({data:i.getDate()+"/"+(i.getMonth()+1),pesoBruto:r[s].pesoBruto,pesoLiquido:r[s].pesoLiquido})}else{e.push({data:15-s+"/02",pesoBruto:5e3+Math.random()*2e3,pesoLiquido:4950+Math.random()*1900})}}return e},_getComparacaoBarcacas:function(a){var e=this.getView().getModel();var t=e.getProperty("/results");var o={};t.forEach(function(a){if(!o[a.barcaca]){o[a.barcaca]={barcaca:a.barcaca,pesoBruto:0,pesoLiquido:0,count:0}}o[a.barcaca].pesoBruto+=a.pesoBruto;o[a.barcaca].pesoLiquido+=a.pesoLiquido;o[a.barcaca].count++});var r=[];for(var s in o){var i=o[s];r.push({barcaca:i.barcaca,pesoBruto:Math.round(i.pesoBruto/i.count*100)/100,pesoLiquido:Math.round(i.pesoLiquido/i.count*100)/100})}r.sort(function(e,t){if(e.barcaca===a)return-1;if(t.barcaca===a)return 1;return e.barcaca.localeCompare(t.barcaca)});return r},onCloseChartDialog:function(){this._oChartDialog.close()},onEdit:function(a){var e=a.getSource().getParent().getParent();var o=e.getBindingContext();var r=o.getObject();t.show("Editar: "+r.cte)},formatter:{formatStatusState:function(a){switch(a){case"Disponível":return"Success";case"Processado":return"Information";case"Pendente":return"Warning";case"Cancelado":return"Error";default:return"None"}}}})});
//# sourceMappingURL=View1.controller.js.map